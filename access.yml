---
- name: access switch configurations
  hosts: access
  gather_facts: no
  connection: local

  tasks:
########
  - name: set hostname
    ios_config:
      provider: "{{ provider }}"
      lines: hostname "{{ ansible_hostname }}"
    tags: hostname

########
  - name: create vlans
    ios_config:
      provider: "{{ provider }}"
      lines:
      - name {{ item.name }}
      parents: vlan {{ item.vlan_id }}
    with_items: "{{ vlans }}"
    tags: vlans

########
  - name: trunk port
    ios_config:
      provider: "{{ provider }}"
      lines:
      - switchport trunk encap dot1q
      - switchport mode dynamic desirable
      - switchport trunk allowed vlan none
      parents: interface range {{ item }}
    with_items: "{{ trunk_range }}"
    tags: trunk

########
  - name: trunk vlan allowed
    ios_config:
      provider: "{{ provider }}"
      lines:
      - switchport trunk allowed vlan add {{ item[1] }}
      parents: interface range {{ item[0] }}
    with_nested:
    - "{{ trunk_range }}"
    - "{{ allowed }}"
    tags: allowed

########
  - name: access ports
    ios_config:
      provider: "{{ provider }}"
      lines:
      - switchport mode access 
      - switchport access vlan {{ item[2] }}
      - switchport voice vlan {{ item[1] }}
      parents: interface range {{ item[0] }}
    with_nested: 
    - "{{ acc_range }}"
    - "{{ voice }}"
    - "{{ data }}"
    tags: access